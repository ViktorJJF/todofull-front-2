import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import{r as m,o as s,c as S,e as N,g as V,v as j,f,b as $,D as J,u as _,t as T,w as k,a as v,d as M,p as A,F as D,j as L,ao as K,k as Q,m as R,n as W,l as Z}from"./index.aed0d878.js";import{m as z,c as q}from"./categories.5c8593ae.js";const ee={};function te(e,a){const t=m("v-btn");return s(),S(t,{icon:"mdi-plus",size:"x-small"})}var F=G(ee,[["render",te]]);const H=["#6eda4d","#ffcc00","#beef37","#fbf82d","#acbef3","#6eda4d","#ffcc00","#beef37","#fbf82d","#acbef3"];const ae={class:"row"},le={class:"col d-flex align-center flex-column"},ne={key:0,class:"mt-3"},oe={key:0,class:"col col-wrapper"},de={key:1,class:"col d-flex justify-start"},se=N({__name:"CategoryItem",props:{item:{type:Object,required:!0},showAddBottom:{type:Boolean},level:{type:Number,default:0},maxLevel:{type:Number}},emits:["addItem","update:item","mappingClick"],setup(e,{emit:a}){const t=e,n=V(!1),o=j(()=>t.level<t.maxLevel),g=c=>{a("addItem",c)},i=c=>{a("update:item",c)},p=c=>{const r=c.target.innerText,l={...t.item,name:r.trim()};i(l)},C=c=>{a("mappingClick",c)};return(c,r)=>{const l=m("v-icon"),y=m("v-tooltip"),w=m("v-btn"),U=m("CategoryItem",!0);return s(),f("div",ae,[$("div",le,[$("div",{class:"box",style:J({backgroundColor:_(H)[e.level]}),onMouseenter:r[1]||(r[1]=b=>n.value=!0),onMouseleave:r[2]||(r[2]=b=>n.value=!1)},[$("div",{class:"box-text",contenteditable:"",onInput:p},T(e.item.name),33),n.value?(s(),S(w,{key:0,class:"box-action",size:"small",icon:"",variant:"text",color:"dark",onClick:r[0]||(r[0]=b=>C(e.item))},{default:k(()=>[v(l,null,{default:k(()=>[M("mdi-sitemap-outline")]),_:1}),v(y,{activator:"parent",location:"bottom"},{default:k(()=>[M("Mapeo")]),_:1})]),_:1})):A("",!0)],36),e.showAddBottom?(s(),f("div",ne,[v(F,{onClick:r[3]||(r[3]=b=>g(e.item.parent)),color:_(H)[e.level]},null,8,["color"])])):A("",!0)]),e.item.children.length?(s(),f("div",oe,[(s(!0),f(D,null,L(e.item.children,(b,d)=>(s(),S(U,{key:b._id,item:b,"show-add-bottom":d===e.item.children.length-1,level:e.level+1,"max-level":e.maxLevel,onAddItem:g,"onUpdate:item":i,onMappingClick:C},null,8,["item","show-add-bottom","level","max-level"]))),128))])):_(o)?(s(),f("div",de,[v(F,{class:"mt-2",onClick:r[4]||(r[4]=b=>g(e.item._id)),color:_(H)[e.level]},null,8,["color"])])):A("",!0)])}}});var ce=G(se,[["__scopeId","data-v-918d9b24"]]);const re={class:"row align-center"},ie=N({__name:"index",props:{items:null,headers:null},emits:["addItem","addHeader","update:item","mappingClick"],setup(e,{emit:a}){const t=i=>{a("addItem",i)},n=()=>{a("addHeader")},o=i=>{a("update:item",i)},g=i=>{a("mappingClick",i)};return(i,p)=>{const C=m("v-divider");return s(),f("div",null,[$("div",re,[(s(!0),f(D,null,L(e.headers,(c,r)=>(s(),f("div",{class:"col",key:c.label},[$("div",{class:"box",style:J({backgroundColor:_(H)[r]})},[$("span",null,T(c.label),1)],4)]))),128)),v(F,{onClick:p[0]||(p[0]=c=>n()),color:_(H)[e.headers.length-1]},null,8,["color"])]),v(C,{class:"my-6"}),(s(!0),f(D,null,L(e.items,(c,r)=>(s(),f(D,{key:c._id},[v(ce,{item:c,"show-add-bottom":r===e.items.length-1,"max-level":e.headers.length-1,onAddItem:t,"onUpdate:item":o,onMappingClick:g},null,8,["item","show-add-bottom","max-level"]),v(C,{class:"my-6"})],64))),128))])}}});var ue=G(ie,[["__scopeId","data-v-10f56eac"]]);const me=N({__name:"MercadolibreCategoriesSelect",props:{modelValue:{type:Array},marketplace:{type:Object,required:!0},parent:{type:String},level:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,n=K(),o=V([]),g=V(!1),i=j(()=>o.value.length===0&&g.value===!1),p=j(()=>o.value.length?t.modelValue[t.level]:null),C=async()=>{if(g.value=!0,t.parent){const l=await z.listCategory(t.marketplace._id,t.parent);o.value=l.data.payload.children_categories}else{const l=await z.listCategories(t.marketplace._id);o.value=l.data.payload}g.value=!1};C(),Q(()=>t.parent,()=>{C();const l=t.modelValue.slice(0,t.level);a("update:modelValue",l)});const c=l=>{let y=[...t.modelValue];l?y[t.level]=l:y=y.slice(0,t.level),a("update:modelValue",y)},r=l=>{a("update:modelValue",l)};return(l,y)=>{const w=m("v-select"),U=m("MercadolibreCategoriesSelect",!0);return s(),f("div",{class:W({"mt-2":e.parent})},[_(i)?A("",!0):(s(),S(w,R({key:0,items:o.value,"item-title":"name","item-value":"id"},_(n),{loading:g.value,modelValue:_(p),"onUpdate:modelValue":c}),null,16,["items","loading","modelValue"])),_(p)?(s(),S(U,R({key:1,marketplace:e.marketplace,parent:_(p)},_(n),{level:e.level+1,modelValue:e.modelValue,"onUpdate:modelValue":r}),null,16,["marketplace","parent","level","modelValue"])):A("",!0)],2)}}}),ve=N({__name:"SellercenterCategoriesSelect",props:{modelValue:{type:Array},marketplace:{type:Object,required:!0},parent:{type:Object},level:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,n=K(),o=V([]),g=V(!1),i=j(()=>{if(t.parent){const l=t.parent.Children.Category;return Array.isArray(l)?l:[l]}return o.value}),p=j(()=>{if(!i.value.length)return null;const l=t.modelValue[t.level];return i.value.find(y=>y.CategoryId===l)}),C=async()=>{g.value=!0;const l=await z.listCategories(t.marketplace._id);o.value=l.data.payload,g.value=!1};t.parent||C(),Q(()=>t.parent,()=>{const l=t.modelValue.slice(0,t.level);a("update:modelValue",l)});const c=l=>{let y=[...t.modelValue];l?y[t.level]=l.CategoryId:y=y.slice(0,t.level),a("update:modelValue",y)},r=l=>{a("update:modelValue",l)};return(l,y)=>{const w=m("v-select"),U=m("SellercenterCategoriesSelect",!0);return s(),f("div",{class:W({"mt-2":e.parent})},[v(w,R({items:_(i),"item-title":"Name","item-value":"CategoryId","return-object":""},_(n),{loading:g.value,modelValue:_(p),"onUpdate:modelValue":c}),null,16,["items","loading","modelValue"]),_(p)&&_(p).Children?(s(),S(U,R({key:0,marketplace:e.marketplace,parent:_(p)},_(n),{level:e.level+1,modelValue:e.modelValue,"onUpdate:modelValue":r}),null,16,["marketplace","parent","level","modelValue"])):A("",!0)],2)}}}),pe=["onSubmit"],_e={class:"mb-4"},ge=N({__name:"MappingForm",props:{item:null},emits:["update:item"],setup(e,{emit:a}){const t=e,n=V([]),o=V({...t.item});z.list().then(i=>{n.value=i.data.payload});const g=()=>{a("update:item",o.value)};return(i,p)=>{const C=m("v-card-title"),c=m("v-text-field"),r=m("v-card-text"),l=m("v-spacer"),y=m("v-btn"),w=m("v-card-actions"),U=m("v-card");return s(),f("form",{onSubmit:Z(g,["prevent"])},[v(U,null,{default:k(()=>[v(C,null,{default:k(()=>[M(T(e.item.name),1)]),_:1}),v(r,null,{default:k(()=>[(s(!0),f(D,null,L(n.value,b=>(s(),f("div",_e,[M(T(b.name)+" ",1),b.type==="woocommerce"?(s(),S(c,{key:0,variant:"outlined",density:"compact","hide-details":""})):b.type==="mercadolibre"?(s(),S(me,{key:1,marketplace:b,density:"compact",variant:"outlined","hide-details":"",clearable:"",placeholder:"Seleccionar categor\xEDa",modelValue:o.value.mercadolibre,"onUpdate:modelValue":p[0]||(p[0]=d=>o.value.mercadolibre=d)},null,8,["marketplace","modelValue"])):A("",!0),b.type==="sellercenter"?(s(),S(ve,{key:2,marketplace:b,variant:"outlined",density:"compact","hide-details":"",clearable:"",placeholder:"Seleccionar categor\xEDa",modelValue:o.value.sellercenter,"onUpdate:modelValue":p[1]||(p[1]=d=>o.value.sellercenter=d)},null,8,["marketplace","modelValue"])):A("",!0)]))),256))]),_:1}),v(w,null,{default:k(()=>[v(l),v(y,{type:"submit"},{default:k(()=>[M("Guardar")]),_:1})]),_:1})]),_:1})],40,pe)}}});let O;const ye=new Uint8Array(16);function he(){if(!O&&(O=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(ye)}const h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function be(e,a=0){return(h[e[a+0]]+h[e[a+1]]+h[e[a+2]]+h[e[a+3]]+"-"+h[e[a+4]]+h[e[a+5]]+"-"+h[e[a+6]]+h[e[a+7]]+"-"+h[e[a+8]]+h[e[a+9]]+"-"+h[e[a+10]]+h[e[a+11]]+h[e[a+12]]+h[e[a+13]]+h[e[a+14]]+h[e[a+15]]).toLowerCase()}const fe=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var P={randomUUID:fe};function Ce(e,a,t){if(P.randomUUID&&!a&&!e)return P.randomUUID();e=e||{};const n=e.random||(e.rng||he)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,a){t=t||0;for(let o=0;o<16;++o)a[t+o]=n[o];return a}return be(n)}const Ie=N({__name:"Categories",setup(e){const a=V([{label:"Departamento"},{label:"Categorias"},{label:"Categoria Hija"},{label:"Categoria Hija 2"},{label:"Categoria Hija 3"}]),t=V([]),n=V([]),o=V(!1),g=V(null),i=V(!1);q.list().then(d=>{n.value=d.data.payload});const p=j(()=>r(n.value)),C=d=>{g.value=d,i.value=!0},c=(d,u)=>{const I=[];for(const x of u)d._id===x.parent&&(Object.assign(x,{children:c(x,u)}),I.push(x));return I},r=d=>{const u=[];for(const I of d)I.parent===null&&(Object.assign(I,{children:c(I,d)}),u.push(I));return u},l=d=>{const u={_id:Ce(),name:"Categoria",parent:d,children:[],isNew:!0,mercadolibre:[],sellercenter:[]};n.value.push(u),t.value.push(u)},y=()=>{a.value.push({label:`Categoria Hija ${a.value.length-1}`})},w=d=>{let u=n.value.findIndex(x=>x._id===d._id);if(n.value.splice(u,1,d),u=t.value.findIndex(x=>x._id===d._id),u===-1)return t.value.push(d);t.value.splice(u,1,d)},U=async d=>{w(d),i.value=!1},b=async()=>{o.value=!0;const d=t.value.map(async u=>{const x=(u.isNew?await q.create(u):await q.update(u._id,u)).data.payload;Object.assign(u,x);const B=n.value.findIndex(E=>E._id===x._id);B!==-1&&n.value.splice(B,1,u)});await Promise.allSettled(d),t.value=[],o.value=!1};return(d,u)=>{const I=m("v-card-title"),x=m("v-btn"),B=m("v-card-text"),E=m("v-dialog"),X=m("v-card");return s(),S(X,{class:"overflow-x-auto"},{default:k(()=>[v(I,null,{default:k(()=>[M("Categorias")]),_:1}),v(B,{style:{display:"inline-block"}},{default:k(()=>[v(x,{class:"ml-3 mb-2",disabled:!t.value.length,loading:o.value,onClick:b},{default:k(()=>[M(" Guardar ")]),_:1},8,["disabled","loading"]),v(ue,{headers:a.value,items:_(p),onAddItem:l,onAddHeader:y,"onUpdate:item":w,onMappingClick:C},null,8,["headers","items"])]),_:1}),v(E,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=Y=>i.value=Y),"max-width":"600px"},{default:k(()=>[v(ge,{item:g.value,"onUpdate:item":U},null,8,["item"])]),_:1},8,["modelValue"])]),_:1})}}});export{Ie as default};
