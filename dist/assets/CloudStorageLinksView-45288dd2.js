import{_ as z,r as f,o as d,c as V,w as u,a as o,b as l,t as w,e as K,g as v,D as le,f as h,F as I,k as R,j as y,J as $,K as P,l as H,d as A,n as he,S as Z,i as ge,C as be,aq as ye,v as Ce,u as F,ar as ee,ah as we}from"./index-dd6f4a47.js";import{P as Se,C as Fe,a as ke,E as Te}from"./espania-2378a770.js";const Le={props:{initialData:{type:Array,default:()=>[]}},data(){return{disabled:!1,todofullLabels:[],selectedTodofullLabels2:[],selectedTodofullLabels:[],searchLabel:"",isInidialDataLoading:!1,isInitialDataExecuted:!1}},computed:{filteredTodofullLabels(){return this.todofullLabels.filter(t=>t.is_active)}},watch:{selectedTodofullLabels:{handler(t,a){this.searchLabel="",this.$emit("onSelectTodofullLabels",JSON.parse(JSON.stringify(this.selectedTodofullLabels))),this.disabled=!0,setTimeout(()=>{this.disabled=!1},0)},deep:!0}},async mounted(){var t;this.selectedTodofullLabels=((t=this.initialData)==null?void 0:t.map(a=>typeof a=="string"?a:a._id))||[],this.$store.state.todofullLabelsModule.todofullLabels.length===0&&await this.$store.dispatch("todofullLabelsModule/list",{sort:"name",order:"asc"}),this.todofullLabels=this.$store.state.todofullLabelsModule.todofullLabels.map(a=>({_id:a._id,name:a.name,is_active:a.is_active}))},methods:{async removeLabels(t,a){t.splice(t.findIndex(p=>p._id===a._id),1),this.$emit("onSelectTodofullLabels",this.selectedTodofullLabels)},getLabelTitle(t){const a=this.todofullLabels.find(p=>p.value==t);return a?a.title:""}}};function xe(t,a,p,g,m,c){const _=f("v-chip"),e=f("v-combobox");return d(),V(e,{"hide-details":"",variant:"outlined",disabled:m.disabled,placeholder:"Selecciona las etiquetas",class:"mt-3","search-input":m.searchLabel,modelValue:m.selectedTodofullLabels,"onUpdate:modelValue":a[1]||(a[1]=k=>m.selectedTodofullLabels=k),"item-value":"_id","item-title":"name","return-object":!1,items:c.filteredTodofullLabels,multiple:"","no-data-text":"No se encontraron etiquetas",outlined:"",density:"compact"},{selection:u(k=>[o(_,{close:"","onClick:close":a[0]||(a[0]=b=>c.removeLabels(m.selectedTodofullLabels,t.item)),color:"primary"},{default:u(()=>[l("strong",null,w(k.item.title),1)]),_:2},1024)]),_:1},8,["disabled","search-input","modelValue","items"])}const Ve=z(Le,[["render",xe],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/TodofullLabelsSelectorV2.vue"]]),Ne={props:{initialData:{type:Object,default:{}},country:{type:String,default:"Chile"}},data(){return{disabled:!1,negotiationStatuses:[],selectedNegotiationStatuses:[],searchLabel:"",isInidialDataLoading:!1,isInitialDataExecuted:!1}},watch:{selectedNegotiationStatuses:{handler(t,a){this.searchLabel="",this.$emit("onSelectNegotiationStatuses",this.selectedNegotiationStatuses?JSON.parse(JSON.stringify(this.selectedNegotiationStatuses)):null),this.disabled=!0,setTimeout(()=>{this.disabled=!1},0)},deep:!0}},async mounted(){this.initialData&&(this.selectedNegotiationStatuses=this.initialData._id),await this.$store.dispatch("negotiationStatusesModule/list",{sort:"name",order:"asc",country:this.country}),this.negotiationStatuses=this.$store.state.negotiationStatusesModule.negotiationStatuses.map(t=>({value:t._id,title:t.name})),console.log("🚀 Aqui *** -> this.negotiationStatuses",this.negotiationStatuses)},methods:{async removeLabels(t,a){t.splice(t.findIndex(p=>p._id===a._id),1),this.$emit("onSelectNegotiationStatuses",this.selectedNegotiationStatuses)},getLabelTitle(t){const a=this.negotiationStatuses.find(p=>p.value==t);return a?a.title:""}}};function De(t,a,p,g,m,c){const _=f("v-select");return d(),V(_,{"hide-details":"",variant:"outlined",disabled:m.disabled,placeholder:"Selecciona el estado de negociación",class:"mt-3",modelValue:m.selectedNegotiationStatuses,"onUpdate:modelValue":a[0]||(a[0]=e=>m.selectedNegotiationStatuses=e),items:m.negotiationStatuses,"no-data-text":"No se encontraron estados de negociación",outlined:"",clearable:"",density:"compact"},null,8,["disabled","modelValue","items"])}const $e=z(Ne,[["render",De],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/NegotiationStatusesSelector.vue"]]),te=()=>({name:"",url:"",files:"",fileType:"",country:""}),Pe={class:"file-preview"},Ue={class:"uploaded-file"},Ae=["href"],Ie=["onClick"],Me=K({__name:"UploadFiles",props:{files:{type:Array,default:()=>[]}},emits:["onNewFiles"],setup(t,{emit:a}){const p=t,g=v(!1),m=v(null),c=v(null);v(!1);const _=v(null),e=v([]);le(()=>{p.files&&(e.value=[...p.files])});function k(s){g.value||(g.value=!0),s.preventDefault()}function b(s){s.currentTarget.contains(s.relatedTarget)||(s.preventDefault(),g.value=!1)}function M(s){if(s.stopPropagation(),s.preventDefault(),g.value=!1,s.dataTransfer&&s.dataTransfer.files.length)for(const S of Array.from(s.dataTransfer.files))O(S)}function L(){var s;(s=m.value)==null||s.click()}function U(){if(m.value&&m.value.files){const s=Array.from(m.value.files);for(const S of s)O(S)}}function O(s){_.value=s,e.value.push(s),a("onNewFiles",e.value)}function x(s){e.value.splice(s,1),a("onNewFiles",e.value)}return(s,S)=>{const B=f("v-col"),N=f("v-row"),J=f("v-container");return d(),h("div",null,[o(J,null,{default:u(()=>[o(N,null,{default:u(()=>[e.value.length?(d(),V(B,{key:0,cols:"6"},{default:u(()=>[l("div",Pe,[(d(!0),h(I,null,R(e.value,(G,E)=>(d(),h(I,{key:E},[y(' <img v-if="isImageFile" :src="filePreviewUrl" alt="Uploaded Image" /> '),l("div",Ue,[l("a",{class:"uploaded-link",href:c.value,download:""},w(G.name),9,Ae),l("button",{class:"clear-uploaded-file mb-1 ml-2",onClick:X=>x(E)}," X ",8,Ie)])],64))),128))])]),_:1})):y("v-if",!0),o(B,{cols:e.value.length?"6":"12",class:"container-upload",onClick:L},{default:u(()=>[l("div",{onDragover:k,onDragleave:b,onDrop:M,class:"drag-message"},[$(l("span",null,"Arrastra una imagen o archivo aquí",512),[[P,!g.value]]),$(l("span",null,"Suelta los archivos aquí",512),[[P,g.value]])],32),l("input",{type:"file",ref_key:"fileInput",ref:m,onChange:U,multiple:"",style:{display:"none"}},null,544)]),_:1},8,["cols"])]),_:1})]),_:1})])}}});const Oe=z(Me,[["__scopeId","data-v-0a8adf92"],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/UploadFiles.vue"]]),je={class:"d-flex justify-space-evenly"},ze=["src"],Be=K({__name:"CountrySelector",emits:["onSelectedCountry"],setup(t,{emit:a}){const p=v([{value:"Peru",icon:Se},{value:"Chile",icon:Fe},{value:"Colombia",icon:ke},{value:"España",icon:Te}]),g=v("Chile");function m(c){if(g.value===c.value)return g.value=null;g.value=c.value}return H(g,()=>{a("onSelectedCountry",g.value)},{immediate:!0}),(c,_)=>{const e=f("v-tooltip"),k=f("v-btn");return d(),h("div",je,[(d(!0),h(I,null,R(p.value,(b,M)=>(d(),V(k,{small:"",icon:"",color:"white",onClick:L=>m(b),class:he({selected:g.value===b.value}),key:M},{default:u(()=>[l("img",{style:{width:"25px"},src:b.icon},null,8,ze),o(e,{activator:"parent",anchor:"bottom"},{default:u(()=>[A(w(b.value),1)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))])}}}),Ee=z(Be,[["__file","D:/trabajo/Todofull/todofull-front-2/src/components/CountrySelector.vue"]]),qe={class:"col-12"},Re={class:"card box-margin"},Je={class:"card-body"},Ge={class:"row my-3"},He={class:"col-sm-12 col-md-7"},Ke={class:"col-sm-12 col-md-5"},Xe={class:"dataTables_info",id:"datatable-buttons_info",role:"status","aria-live":"polite"},Qe={class:"basic-table-area"},We=l("th",{class:"text-left"},"Fecha de creación",-1),Ye={key:0,class:"text-left"},Ze=l("th",{class:"text-left"},"Nombre",-1),et={key:1,class:"text-left"},tt={key:2,class:"text-left"},lt=l("th",{class:"text-left"},null,-1),at={key:0},ot=["href"],st=["href"],nt={key:1},it={key:2},ut={class:"row my-3"},dt={class:"col-sm-12 col-md-5"},rt={class:"dataTables_info",id:"datatable-buttons_info",role:"status","aria-live":"polite"},ct={class:"col-sm-12 col-md-7"},ft={class:"headline"},vt=l("p",{class:"body-1 font-weight-bold"},"Nombre",-1),mt=l("div",{class:"flex-grow-1"},null,-1),_t=K({__name:"CloudStorageLinksView",props:{showFromChat:{type:Boolean,default:!1},country:{type:String,default:""}},emits:["onSendCatalog"],setup(t,{emit:a}){const p=t,g=Z("$deepCopy"),m=Z("$swal"),c=ge();be(),ye();const _=v([]),e=v(te()),k=v(te());v({});const b=v(1);v(0);const M=v(["name"]),L=v(""),U=v(!1),O=v(null),x=v(-1),s=v("Chile");v([{text:"Agregado",align:"left",sortable:!1,value:"createdAt"},{text:"Nombre",align:"left",sortable:!1,value:"name"},{text:"Acciones",value:"action",sortable:!1}]);const S=v(!1),B=Ce(()=>x.value===-1?"Cargar Catálogo":"Editar Catálogo");H(L,()=>{clearTimeout(O.value),O.value=setTimeout(()=>{b.value=1,N(b.value)},600)}),H(b,()=>{N(b.value)}),le(()=>{N()});async function N(i=1){let n={page:b.value||i,fields:M.value.join(","),sort:"createdAt",order:"desc",limit:10};s.value&&(n.country=s.value),L.value&&(n.filter=L.value),p.showFromChat&&(n.isActive=!0),await Promise.all([c.dispatch("cloudStorageLinksModule/list",n)]),_.value=g(c.state.cloudStorageLinksModule.cloudStorageLinks)}async function J(){if(U.value=!0,x.value>-1){e.value.country=s.value;let i=_.value[x.value]._id;try{e.value.preFiles&&(e.value.files=await Promise.all(e.value.preFiles.map(async n=>n.url?n.url:await ee(n))),e.value.files=e.value.files.map((n,C)=>({url:n,name:e.value.preFiles[C].name,type:e.value.preFiles[C].type,size:e.value.preFiles[C].size}))),await c.dispatch("cloudStorageLinksModule/update",{id:i,data:e.value}),Object.assign(_.value[x.value],e.value),q()}finally{U.value=!1}}else try{e.value.preFiles&&(e.value.files=await Promise.all(e.value.preFiles.map(async n=>await ee(n))),e.value.files=e.value.files.map((n,C)=>({url:n,name:e.value.preFiles[C].name,type:e.value.preFiles[C].type,size:e.value.preFiles[C].size}))),e.value.country=s.value;let i=await c.dispatch("cloudStorageLinksModule/create",e.value);_.value.push(i),q(),N()}finally{U.value=!1}}function G(i){x.value=_.value.indexOf(i),e.value=Object.assign({},i),S.value=!0}async function E(i){const n=_.value.indexOf(i);let C=_.value[n]._id;(await m({text:"¿Realmente deseas eliminar este registro?",icon:"error",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&(await c.dispatch("cloudStorageLinksModule/delete",C),_.value.splice(n,1))}function X(i){console.log("🚀 Aqui *** -> negotiationStatus:",i),e.value.negotiationStatusId=i}function ae(i){console.log("🚀 Aqui *** -> selectedLabels:",i),i.length>0&&(e.value.todofullLabels=i)}function oe(i){s.value=i,p.country&&(s.value=p.country),e.value.country=i,N()}async function q(){S.value=!1,setTimeout(()=>{e.value=Object.assign({},k.value),x.value=-1},300)}async function se(i){e.value.preFiles=i}function ne(i){a("onSendCatalog",i)}async function ie(i){await c.dispatch("cloudStorageLinksModule/update",{id:i._id,data:i})}return(i,n)=>{const C=f("v-row"),D=f("v-btn"),Q=f("v-pagination"),W=f("v-text-field"),j=f("v-col"),ue=f("v-checkbox"),de=f("v-table"),re=f("v-icon"),ce=f("v-card-title"),fe=f("v-divider"),Y=f("v-container"),ve=f("v-card-actions"),me=f("v-card"),_e=f("v-dialog");return d(),V(Y,{fluid:""},{default:u(()=>[$(o(C,{class:"mb-3"},{default:u(()=>[o(Ee,{onOnSelectedCountry:oe})]),_:1},512),[[P,!t.showFromChat]]),o(C,null,{default:u(()=>[l("div",qe,[l("div",Re,[l("div",Je,[$(o(D,{onClick:n[0]||(n[0]=r=>{q(),S.value=!0})},{default:u(()=>[A("Agregar Catálogo")]),_:1},512),[[P,!t.showFromChat]]),l("div",Ge,[l("div",He,[$(o(Q,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=r=>b.value=r),length:F(c).state.cloudStorageLinksModule.totalPages},null,8,["modelValue","length"]),[[P,!t.showFromChat]])]),$(l("div",Ke,[l("div",Xe," Mostrando "+w(F(c).state.itemsPerPage>_.value.length?_.value.length:F(c).state.itemsPerPage)+" de "+w(F(c).state.cloudStorageLinksModule.total)+" registros ",1)],512),[[P,!t.showFromChat]])]),o(j,{cols:"12",sm:"8"},{default:u(()=>[o(W,{style:{"background-color":"#fff"},dense:"","hide-details":"",modelValue:L.value,"onUpdate:modelValue":n[2]||(n[2]=r=>L.value=r),placeholder:"Escribe el nombre del catálogo",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),l("div",Qe,[y("Basic Table"),o(de,null,{default:u(()=>[l("thead",null,[l("tr",null,[We,t.showFromChat?y("v-if",!0):(d(),h("th",Ye,"URL")),Ze,t.showFromChat?y("v-if",!0):(d(),h("th",et,"Veces usado")),t.showFromChat?y("v-if",!0):(d(),h("th",tt,"Activo?")),lt])]),l("tbody",null,[(d(!0),h(I,null,R(_.value,r=>(d(),h("tr",{key:r._id},[l("td",null,w(F(we)(r.createdAt,"dd/MM/yyyy HH:mm")),1),t.showFromChat?y("v-if",!0):(d(),h("td",at,[r.url?(d(),h("a",{key:0,href:r.url,target:"_blank",rel:"noopener noreferrer"},w(r.url),9,ot)):(d(!0),h(I,{key:1},R(r.files,(T,pe)=>(d(),h("div",{key:pe},[T.url?(d(),h("a",{key:0,href:T.url,target:"_blank",rel:"noopener noreferrer"},w(T.url),9,st)):y("v-if",!0)]))),128))])),l("td",null,w(r.name),1),t.showFromChat?y("v-if",!0):(d(),h("td",nt,w(r.timesUsed),1)),t.showFromChat?y("v-if",!0):(d(),h("td",it,[o(ue,{onChange:T=>ie(r),modelValue:r.isActive,"onUpdate:modelValue":T=>r.isActive=T},null,8,["onChange","modelValue","onUpdate:modelValue"])])),l("td",null,[y(` <PDFViewer\r
                      :pdfUrl="'https://databot-files.s3.amazonaws.com/Generar+Admin+Token+para+uso+API+Shopify.pdf'"\r
                    ></PDFViewer> `),t.showFromChat?(d(),V(D,{key:1,color:"primary",size:"small",class:"mr-2",onClick:T=>ne(r)},{default:u(()=>[A("Enviar")]),_:2},1032,["onClick"])):(d(),h(I,{key:0},[o(D,{color:"primary",icon:"mdi mdi-eye",size:"x-small",class:"mr-2"}),o(D,{onClick:T=>G(r),color:"success",icon:"mdi mdi-pencil",size:"x-small",class:"mr-2"},null,8,["onClick"]),o(D,{onClick:T=>E(r),color:"error",icon:"mdi mdi-delete",size:"x-small"},null,8,["onClick"])],64))])]))),128))])]),_:1}),y("End Basic Table")]),l("div",ut,[$(l("div",dt,[l("div",rt," Mostrando "+w(F(c).state.itemsPerPage>_.value.length?_.value.length:F(c).state.itemsPerPage)+" de "+w(F(c).state.cloudStorageLinksModule.total)+" registros ",1)],512),[[P,!t.showFromChat]]),l("div",ct,[o(Q,{modelValue:b.value,"onUpdate:modelValue":n[3]||(n[3]=r=>b.value=r),length:F(c).state.cloudStorageLinksModule.totalPages},null,8,["modelValue","length"])])])])])]),o(_e,{modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=r=>S.value=r),width:"700px"},{default:u(()=>[o(me,null,{default:u(()=>[o(ce,null,{default:u(()=>[o(re,{color:"primary",class:"mr-1"},{default:u(()=>[A("mdi-cloud-upload")]),_:1}),l("span",ft,w(F(B)),1)]),_:1}),o(fe),o(Y,{class:"pa-5"},{default:u(()=>[o(C,{dense:""},{default:u(()=>[o(j,{cols:"12",sm:"12",md:"12"},{default:u(()=>[vt,o(W,{modelValue:e.value.name,"onUpdate:modelValue":n[4]||(n[4]=r=>e.value.name=r),"hide-details":"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),o(j,{cols:"12",sm:"12"},{default:u(()=>[o(Ve,{initialData:e.value.todofullLabels,class:"my-3",onOnSelectTodofullLabels:ae},null,8,["initialData"])]),_:1}),o(j,{cols:"12",sm:"12"},{default:u(()=>[S.value?(d(),V($e,{key:0,initialData:e.value.negotiationStatusId,country:s.value,class:"my-3",onOnSelectNegotiationStatuses:X},null,8,["initialData","country"])):y("v-if",!0)]),_:1}),y(` <v-col cols="12" sm="12" md="12">\r
                <p class="body-1 font-weight-bold">URL (Opcional)</p>\r
                <v-text-field\r
                  v-model="editedItem.url"\r
                  required\r
                  hide-details\r
                  variant="underlined"\r
                ></v-text-field>\r
              </v-col> `),o(j,{cols:"12",sm:"12"},{default:u(()=>[l("div",null,[S.value?(d(),V(Oe,{key:0,files:e.value.files,onOnNewFiles:se},null,8,["files"])):y("v-if",!0)])]),_:1})]),_:1})]),_:1}),o(ve,{"rd-actions":""},{default:u(()=>[mt,o(D,{outlined:"",color:"error",text:"",onClick:q},{default:u(()=>[A("Cancelar")]),_:1}),o(D,{loading:U.value,color:"success",onClick:J},{default:u(()=>[A("Guardar")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),pt=z(_t,[["__file","D:/trabajo/Todofull/todofull-front-2/src/views/CloudStorageLinksView.vue"]]),bt=Object.freeze(Object.defineProperty({__proto__:null,default:pt},Symbol.toStringTag,{value:"Module"}));export{pt as C,$e as N,Ve as T,bt as a};
