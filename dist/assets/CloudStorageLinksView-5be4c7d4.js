import{_ as j,r as m,o as r,c as x,w as n,a as t,b as l,t as C,e as K,g as _,f as h,F as I,k as z,j as y,J as U,K as P,l as H,d as M,n as he,S as Y,i as pe,C as ge,ap as be,v as ye,D as Ce,u as k,aq as Z,ah as we}from"./index-85899b3e.js";import{P as Se,C as ke,a as Te,E as Le}from"./espania-2378a770.js";const Ve={props:{initialData:{type:Array,default:()=>[]}},data(){return{disabled:!1,todofullLabels:[],selectedTodofullLabels2:[],selectedTodofullLabels:[],searchLabel:"",isInidialDataLoading:!1,isInitialDataExecuted:!1}},computed:{filteredTodofullLabels(){return this.todofullLabels.filter(e=>e.is_active)}},watch:{selectedTodofullLabels:{handler(e,a){this.searchLabel="",this.$emit("onSelectTodofullLabels",JSON.parse(JSON.stringify(this.selectedTodofullLabels))),this.disabled=!0,setTimeout(()=>{this.disabled=!1},0)},deep:!0}},async mounted(){var e;this.selectedTodofullLabels=((e=this.initialData)==null?void 0:e.map(a=>typeof a=="string"?a:a._id))||[],this.$store.state.todofullLabelsModule.todofullLabels.length===0&&await this.$store.dispatch("todofullLabelsModule/list",{sort:"name",order:"asc"}),this.todofullLabels=this.$store.state.todofullLabelsModule.todofullLabels.map(a=>({_id:a._id,name:a.name,is_active:a.is_active}))},methods:{async removeLabels(e,a){e.splice(e.findIndex(v=>v._id===a._id),1),this.$emit("onSelectTodofullLabels",this.selectedTodofullLabels)},getLabelTitle(e){const a=this.todofullLabels.find(v=>v.value==e);return a?a.title:""}}};function xe(e,a,v,g,b,f){const d=m("v-chip"),o=m("v-combobox");return r(),x(o,{"hide-details":"",variant:"outlined",disabled:b.disabled,placeholder:"Selecciona las etiquetas",class:"mt-3","search-input":b.searchLabel,modelValue:b.selectedTodofullLabels,"onUpdate:modelValue":a[1]||(a[1]=T=>b.selectedTodofullLabels=T),"item-value":"_id","item-title":"name","return-object":!1,items:f.filteredTodofullLabels,multiple:"","no-data-text":"No se encontraron etiquetas",outlined:"",density:"compact"},{selection:n(T=>[t(d,{close:"","onClick:close":a[0]||(a[0]=p=>f.removeLabels(b.selectedTodofullLabels,e.item)),color:"primary"},{default:n(()=>[l("strong",null,C(T.item.title),1)]),_:2},1024)]),_:1},8,["disabled","search-input","modelValue","items"])}const Fe=j(Ve,[["render",xe],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/TodofullLabelsSelectorV2.vue"]]),Ne={props:{initialData:{type:Object,default:{}},country:{type:String,default:"Chile"}},data(){return{disabled:!1,negotiationStatuses:[],selectedNegotiationStatuses:[],searchLabel:"",isInidialDataLoading:!1,isInitialDataExecuted:!1}},watch:{selectedNegotiationStatuses:{handler(e,a){this.searchLabel="",this.$emit("onSelectNegotiationStatuses",this.selectedNegotiationStatuses?JSON.parse(JSON.stringify(this.selectedNegotiationStatuses)):null),this.disabled=!0,setTimeout(()=>{this.disabled=!1},0)},deep:!0}},async mounted(){this.initialData&&(this.selectedNegotiationStatuses=this.initialData._id),await this.$store.dispatch("negotiationStatusesModule/list",{sort:"name",order:"asc",country:this.country}),this.negotiationStatuses=this.$store.state.negotiationStatusesModule.negotiationStatuses.map(e=>({value:e._id,title:e.name})),console.log("🚀 Aqui *** -> this.negotiationStatuses",this.negotiationStatuses)},methods:{async removeLabels(e,a){e.splice(e.findIndex(v=>v._id===a._id),1),this.$emit("onSelectNegotiationStatuses",this.selectedNegotiationStatuses)},getLabelTitle(e){const a=this.negotiationStatuses.find(v=>v.value==e);return a?a.title:""}}};function De(e,a,v,g,b,f){const d=m("v-select");return r(),x(d,{"hide-details":"",variant:"outlined",disabled:b.disabled,placeholder:"Selecciona el estado de negociación",class:"mt-3",modelValue:b.selectedNegotiationStatuses,"onUpdate:modelValue":a[0]||(a[0]=o=>b.selectedNegotiationStatuses=o),items:b.negotiationStatuses,"no-data-text":"No se encontraron estados de negociación",outlined:"",clearable:"",density:"compact"},null,8,["disabled","modelValue","items"])}const $e=j(Ne,[["render",De],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/NegotiationStatusesSelector.vue"]]),ee=()=>({name:"",url:"",files:"",fileType:"",country:""}),Ue={class:"file-preview"},Pe={class:"uploaded-file"},Ae=["href"],Me=["onClick"],Ie=K({__name:"UploadFiles",emits:["onNewFiles"],setup(e,{emit:a}){const v=_(!1),g=_(null),b=_(null);_(!1);const f=_(null),d=_([]);function o(s){v.value||(v.value=!0),s.preventDefault()}function T(s){s.currentTarget.contains(s.relatedTarget)||(s.preventDefault(),v.value=!1)}function p(s){if(s.stopPropagation(),s.preventDefault(),v.value=!1,s.dataTransfer&&s.dataTransfer.files.length)for(const w of Array.from(s.dataTransfer.files))F(w)}function O(){var s;(s=g.value)==null||s.click()}function V(){if(g.value&&g.value.files){const s=Array.from(g.value.files);for(const w of s)F(w)}}function F(s){f.value=s,d.value.push(s),a("onNewFiles",d.value)}function B(s){d.value.splice(s,1),a("onNewFiles",d.value)}return(s,w)=>{const S=m("v-col"),R=m("v-row"),N=m("v-container");return r(),h("div",null,[t(N,null,{default:n(()=>[t(R,null,{default:n(()=>[d.value.length?(r(),x(S,{key:0,cols:"6"},{default:n(()=>[l("div",Ue,[(r(!0),h(I,null,z(d.value,(J,E)=>(r(),h(I,{key:E},[y(' <img v-if="isImageFile" :src="filePreviewUrl" alt="Uploaded Image" /> '),l("div",Pe,[l("a",{class:"uploaded-link",href:b.value,download:""},C(J.name),9,Ae),l("button",{class:"clear-uploaded-file mb-1 ml-2",onClick:X=>B(E)}," X ",8,Me)])],64))),128))])]),_:1})):y("v-if",!0),t(S,{cols:d.value.length?"6":"12",class:"container-upload",onClick:O},{default:n(()=>[l("div",{onDragover:o,onDragleave:T,onDrop:p,class:"drag-message"},[U(l("span",null,"Arrastra una imagen o archivo aquí",512),[[P,!v.value]]),U(l("span",null,"Suelta los archivos aquí",512),[[P,v.value]])],32),l("input",{type:"file",ref_key:"fileInput",ref:g,onChange:V,multiple:"",style:{display:"none"}},null,544)]),_:1},8,["cols"])]),_:1})]),_:1})])}}});const Oe=j(Ie,[["__scopeId","data-v-0a8adf92"],["__file","D:/trabajo/Todofull/todofull-front-2/src/components/UploadFiles.vue"]]),je={class:"d-flex justify-space-evenly"},Be=["src"],Ee=K({__name:"CountrySelector",emits:["onSelectedCountry"],setup(e,{emit:a}){const v=_([{value:"Peru",icon:Se},{value:"Chile",icon:ke},{value:"Colombia",icon:Te},{value:"España",icon:Le}]),g=_("Chile");function b(f){if(g.value===f.value)return g.value=null;g.value=f.value}return H(g,()=>{a("onSelectedCountry",g.value)},{immediate:!0}),(f,d)=>{const o=m("v-tooltip"),T=m("v-btn");return r(),h("div",je,[(r(!0),h(I,null,z(v.value,(p,O)=>(r(),x(T,{small:"",icon:"",color:"white",onClick:V=>b(p),class:he({selected:g.value===p.value}),key:O},{default:n(()=>[l("img",{style:{width:"25px"},src:p.icon},null,8,Be),t(o,{activator:"parent",anchor:"bottom"},{default:n(()=>[M(C(p.value),1)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))])}}}),qe=j(Ee,[["__file","D:/trabajo/Todofull/todofull-front-2/src/components/CountrySelector.vue"]]),ze={class:"col-12"},Re={class:"card box-margin"},Je={class:"card-body"},Ge={class:"row my-3"},He={class:"col-sm-12 col-md-7"},Ke={class:"col-sm-12 col-md-5"},Xe={class:"dataTables_info",id:"datatable-buttons_info",role:"status","aria-live":"polite"},Qe={class:"basic-table-area"},We=l("th",{class:"text-left"},"Fecha de creación",-1),Ye={key:0,class:"text-left"},Ze=l("th",{class:"text-left"},"Nombre",-1),et={key:1,class:"text-left"},tt={key:2,class:"text-left"},lt=l("th",{class:"text-left"},null,-1),at={key:0},ot=["href"],st=["href"],nt={key:1},it={key:2},ut={class:"row my-3"},dt={class:"col-sm-12 col-md-5"},ct={class:"dataTables_info",id:"datatable-buttons_info",role:"status","aria-live":"polite"},rt={class:"col-sm-12 col-md-7"},ft={class:"headline"},vt=l("p",{class:"body-1 font-weight-bold"},"Nombre",-1),mt=l("p",{class:"body-1 font-weight-bold"},"URL (Opcional)",-1),_t=l("div",{class:"flex-grow-1"},null,-1),ht=K({__name:"CloudStorageLinksView",props:{showFromChat:{type:Boolean,default:!1},country:{type:String,default:""}},emits:["onSendCatalog"],setup(e,{emit:a}){const v=e,g=Y("$deepCopy"),b=Y("$swal"),f=pe();ge(),be();const d=_([]),o=_(ee()),T=_(ee());_({});const p=_(1);_(0);const O=_(["name"]),V=_(""),F=_(!1),B=_(null),s=_(-1),w=_("Chile");_([{text:"Agregado",align:"left",sortable:!1,value:"createdAt"},{text:"Nombre",align:"left",sortable:!1,value:"name"},{text:"Acciones",value:"action",sortable:!1}]);const S=_(!1),R=ye(()=>s.value===-1?"Cargar Catálogo":"Editar Catálogo");H(V,()=>{clearTimeout(B.value),B.value=setTimeout(()=>{p.value=1,N(p.value)},600)}),H(p,()=>{N(p.value)}),Ce(()=>{N()});async function N(i=1){let c={page:p.value||i,fields:O.value.join(","),sort:"createdAt",order:"desc",limit:10};w.value&&(c.country=w.value),V.value&&(c.filter=V.value),v.showFromChat&&(c.isActive=!0),await Promise.all([f.dispatch("cloudStorageLinksModule/list",c)]),d.value=g(f.state.cloudStorageLinksModule.cloudStorageLinks)}async function J(){if(F.value=!0,s.value>-1){o.value.country=w.value;let i=d.value[s.value]._id;try{o.value.file&&(o.value.url=await Z(o.value.file)),await f.dispatch("cloudStorageLinksModule/update",{id:i,data:o.value}),Object.assign(d.value[s.value],o.value),q()}finally{F.value=!1}}else try{o.value.preFiles&&(o.value.files=await Promise.all(o.value.preFiles.map(async c=>await Z(c))),o.value.files=o.value.files.map((c,D)=>({url:c,name:o.value.preFiles[D].name}))),o.value.country=w.value;let i=await f.dispatch("cloudStorageLinksModule/create",o.value);d.value.push(i),q(),N()}finally{F.value=!1}}function E(i){s.value=d.value.indexOf(i),o.value=Object.assign({},i),S.value=!0}async function X(i){const c=d.value.indexOf(i);let D=d.value[c]._id;(await b({text:"¿Realmente deseas eliminar este registro?",icon:"error",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&(await f.dispatch("cloudStorageLinksModule/delete",D),d.value.splice(c,1))}function te(i){console.log("🚀 Aqui *** -> negotiationStatus:",i),o.value.negotiationStatusId=i}function le(i){console.log("🚀 Aqui *** -> selectedLabels:",i),i.length>0&&(o.value.todofullLabels=i)}function ae(i){w.value=i,v.country&&(w.value=v.country),o.value.country=i,N()}async function q(){S.value=!1,setTimeout(()=>{o.value=Object.assign({},T.value),s.value=-1},300)}async function oe(i){o.value.preFiles=i}function se(i){a("onSendCatalog",i)}async function ne(i){await f.dispatch("cloudStorageLinksModule/update",{id:i._id,data:i})}return(i,c)=>{const D=m("v-row"),$=m("v-btn"),Q=m("v-pagination"),G=m("v-text-field"),A=m("v-col"),ie=m("v-checkbox"),ue=m("v-table"),de=m("v-icon"),ce=m("v-card-title"),re=m("v-divider"),W=m("v-container"),fe=m("v-card-actions"),ve=m("v-card"),me=m("v-dialog");return r(),x(W,{fluid:""},{default:n(()=>[U(t(D,{class:"mb-3"},{default:n(()=>[t(qe,{onOnSelectedCountry:ae})]),_:1},512),[[P,!e.showFromChat]]),t(D,null,{default:n(()=>[l("div",ze,[l("div",Re,[l("div",Je,[U(t($,{onClick:c[0]||(c[0]=u=>{q(),S.value=!0})},{default:n(()=>[M("Agregar Catálogo")]),_:1},512),[[P,!e.showFromChat]]),l("div",Ge,[l("div",He,[U(t(Q,{modelValue:p.value,"onUpdate:modelValue":c[1]||(c[1]=u=>p.value=u),length:k(f).state.cloudStorageLinksModule.totalPages},null,8,["modelValue","length"]),[[P,!e.showFromChat]])]),U(l("div",Ke,[l("div",Xe," Mostrando "+C(k(f).state.itemsPerPage>d.value.length?d.value.length:k(f).state.itemsPerPage)+" de "+C(k(f).state.cloudStorageLinksModule.total)+" registros ",1)],512),[[P,!e.showFromChat]])]),t(A,{cols:"12",sm:"8"},{default:n(()=>[t(G,{style:{"background-color":"#fff"},dense:"","hide-details":"",modelValue:V.value,"onUpdate:modelValue":c[2]||(c[2]=u=>V.value=u),placeholder:"Escribe el nombre del catálogo",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),l("div",Qe,[y("Basic Table"),t(ue,null,{default:n(()=>[l("thead",null,[l("tr",null,[We,e.showFromChat?y("v-if",!0):(r(),h("th",Ye,"URL")),Ze,e.showFromChat?y("v-if",!0):(r(),h("th",et,"Veces usado")),e.showFromChat?y("v-if",!0):(r(),h("th",tt,"Activo?")),lt])]),l("tbody",null,[(r(!0),h(I,null,z(d.value,u=>(r(),h("tr",{key:u._id},[l("td",null,C(k(we)(u.createdAt,"dd/MM/yyyy HH:mm")),1),e.showFromChat?y("v-if",!0):(r(),h("td",at,[u.url?(r(),h("a",{key:0,href:u.url,target:"_blank",rel:"noopener noreferrer"},C(u.url),9,ot)):(r(!0),h(I,{key:1},z(u.files,(L,_e)=>(r(),h("div",{key:_e},[L.url?(r(),h("a",{key:0,href:L.url,target:"_blank",rel:"noopener noreferrer"},C(L.url),9,st)):y("v-if",!0)]))),128))])),l("td",null,C(u.name),1),e.showFromChat?y("v-if",!0):(r(),h("td",nt,C(u.timesUsed),1)),e.showFromChat?y("v-if",!0):(r(),h("td",it,[t(ie,{onChange:L=>ne(u),modelValue:u.isActive,"onUpdate:modelValue":L=>u.isActive=L},null,8,["onChange","modelValue","onUpdate:modelValue"])])),l("td",null,[y(` <PDFViewer\r
                      :pdfUrl="'https://databot-files.s3.amazonaws.com/Generar+Admin+Token+para+uso+API+Shopify.pdf'"\r
                    ></PDFViewer> `),e.showFromChat?(r(),x($,{key:1,color:"primary",size:"small",class:"mr-2",onClick:L=>se(u)},{default:n(()=>[M("Enviar")]),_:2},1032,["onClick"])):(r(),h(I,{key:0},[t($,{color:"primary",icon:"mdi mdi-eye",size:"x-small",class:"mr-2"}),t($,{onClick:L=>E(u),color:"success",icon:"mdi mdi-pencil",size:"x-small",class:"mr-2"},null,8,["onClick"]),t($,{onClick:L=>X(u),color:"error",icon:"mdi mdi-delete",size:"x-small"},null,8,["onClick"])],64))])]))),128))])]),_:1}),y("End Basic Table")]),l("div",ut,[U(l("div",dt,[l("div",ct," Mostrando "+C(k(f).state.itemsPerPage>d.value.length?d.value.length:k(f).state.itemsPerPage)+" de "+C(k(f).state.cloudStorageLinksModule.total)+" registros ",1)],512),[[P,!e.showFromChat]]),l("div",rt,[t(Q,{modelValue:p.value,"onUpdate:modelValue":c[3]||(c[3]=u=>p.value=u),length:k(f).state.cloudStorageLinksModule.totalPages},null,8,["modelValue","length"])])])])])]),t(me,{modelValue:S.value,"onUpdate:modelValue":c[6]||(c[6]=u=>S.value=u),width:"700px"},{default:n(()=>[t(ve,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(de,{color:"primary",class:"mr-1"},{default:n(()=>[M("mdi-cloud-upload")]),_:1}),l("span",ft,C(k(R)),1)]),_:1}),t(re),t(W,{class:"pa-5"},{default:n(()=>[t(D,{dense:""},{default:n(()=>[t(A,{cols:"12",sm:"12",md:"12"},{default:n(()=>[vt,t(G,{modelValue:o.value.name,"onUpdate:modelValue":c[4]||(c[4]=u=>o.value.name=u),"hide-details":"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(A,{cols:"12",sm:"12"},{default:n(()=>[t(Fe,{initialData:o.value.todofullLabels,class:"my-3",onOnSelectTodofullLabels:le},null,8,["initialData"])]),_:1}),t(A,{cols:"12",sm:"12"},{default:n(()=>[S.value?(r(),x($e,{key:0,initialData:o.value.negotiationStatusId,country:w.value,class:"my-3",onOnSelectNegotiationStatuses:te},null,8,["initialData","country"])):y("v-if",!0)]),_:1}),t(A,{cols:"12",sm:"12",md:"12"},{default:n(()=>[mt,t(G,{modelValue:o.value.url,"onUpdate:modelValue":c[5]||(c[5]=u=>o.value.url=u),required:"","hide-details":"",variant:"underlined"},null,8,["modelValue"])]),_:1}),t(A,{cols:"12",sm:"12"},{default:n(()=>[l("div",null,[S.value?(r(),x(Oe,{key:0,onOnNewFiles:oe})):y("v-if",!0)])]),_:1})]),_:1})]),_:1}),t(fe,{"rd-actions":""},{default:n(()=>[_t,t($,{outlined:"",color:"error",text:"",onClick:q},{default:n(()=>[M("Cancelar")]),_:1}),t($,{loading:F.value,color:"success",onClick:J},{default:n(()=>[M("Guardar")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),pt=j(ht,[["__file","D:/trabajo/Todofull/todofull-front-2/src/views/CloudStorageLinksView.vue"]]),yt=Object.freeze(Object.defineProperty({__proto__:null,default:pt},Symbol.toStringTag,{value:"Module"}));export{pt as C,$e as N,Fe as T,yt as a};
