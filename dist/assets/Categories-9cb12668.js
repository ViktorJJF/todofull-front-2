import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import{r as m,o as s,c as S,f as N,h as V,v as j,g as f,b as $,B as J,u as _,t as T,w as k,a as p,d as M,q as A,F as B,j as L,as as K,l as Q,m as R,n as W,p as Z}from"./index-3376cd88.js";import{m as q,c as F}from"./categories-c639a823.js";const ee={};function te(e,l){const t=m("v-btn");return s(),S(t,{icon:"mdi-plus",size:"x-small"})}const E=G(ee,[["render",te]]),H=["#6eda4d","#ffcc00","#beef37","#fbf82d","#acbef3","#6eda4d","#ffcc00","#beef37","#fbf82d","#acbef3"],le={class:"row"},ae={class:"col d-flex align-center flex-column"},ne={key:0,class:"mt-3"},oe={key:0,class:"col col-wrapper"},de={key:1,class:"col d-flex justify-start"},se=N({__name:"CategoryItem",props:{item:{type:Object,required:!0},showAddBottom:{type:Boolean},level:{type:Number,default:0},maxLevel:{type:Number}},emits:["addItem","update:item","mappingClick"],setup(e,{emit:l}){const t=e,n=V(!1),o=j(()=>t.level<t.maxLevel),g=c=>{l("addItem",c)},i=c=>{l("update:item",c)},v=c=>{const r=c.target.innerText,a={...t.item,name:r.trim()};i(a)},C=c=>{l("mappingClick",c)};return(c,r)=>{const a=m("v-icon"),y=m("v-tooltip"),w=m("v-btn"),U=m("CategoryItem",!0);return s(),f("div",le,[$("div",ae,[$("div",{class:"box",style:J({backgroundColor:_(H)[e.level]}),onMouseenter:r[1]||(r[1]=b=>n.value=!0),onMouseleave:r[2]||(r[2]=b=>n.value=!1)},[$("div",{class:"box-text",contenteditable:"",onInput:v},T(e.item.name),33),n.value?(s(),S(w,{key:0,class:"box-action",size:"small",icon:"",variant:"text",color:"dark",onClick:r[0]||(r[0]=b=>C(e.item))},{default:k(()=>[p(a,null,{default:k(()=>[M("mdi-sitemap-outline")]),_:1}),p(y,{activator:"parent",location:"bottom"},{default:k(()=>[M("Mapeo")]),_:1})]),_:1})):A("",!0)],36),e.showAddBottom?(s(),f("div",ne,[p(E,{onClick:r[3]||(r[3]=b=>g(e.item.parent)),color:_(H)[e.level]},null,8,["color"])])):A("",!0)]),e.item.children.length?(s(),f("div",oe,[(s(!0),f(B,null,L(e.item.children,(b,d)=>(s(),S(U,{key:b._id,item:b,"show-add-bottom":d===e.item.children.length-1,level:e.level+1,"max-level":e.maxLevel,onAddItem:g,"onUpdate:item":i,onMappingClick:C},null,8,["item","show-add-bottom","level","max-level"]))),128))])):_(o)?(s(),f("div",de,[p(E,{class:"mt-2",onClick:r[4]||(r[4]=b=>g(e.item._id)),color:_(H)[e.level]},null,8,["color"])])):A("",!0)])}}});const ce=G(se,[["__scopeId","data-v-e656e753"]]),re={class:"row align-center"},ie=N({__name:"index",props:{items:null,headers:null},emits:["addItem","addHeader","update:item","mappingClick"],setup(e,{emit:l}){const t=i=>{l("addItem",i)},n=()=>{l("addHeader")},o=i=>{l("update:item",i)},g=i=>{l("mappingClick",i)};return(i,v)=>{const C=m("v-divider");return s(),f("div",null,[$("div",re,[(s(!0),f(B,null,L(e.headers,(c,r)=>(s(),f("div",{class:"col",key:c.label},[$("div",{class:"box",style:J({backgroundColor:_(H)[r]})},[$("span",null,T(c.label),1)],4)]))),128)),p(E,{onClick:v[0]||(v[0]=c=>n()),color:_(H)[e.headers.length-1]},null,8,["color"])]),p(C,{class:"my-6"}),(s(!0),f(B,null,L(e.items,(c,r)=>(s(),f(B,{key:c._id},[p(ce,{item:c,"show-add-bottom":r===e.items.length-1,"max-level":e.headers.length-1,onAddItem:t,"onUpdate:item":o,onMappingClick:g},null,8,["item","show-add-bottom","max-level"]),p(C,{class:"my-6"})],64))),128))])}}});const ue=G(ie,[["__scopeId","data-v-6cc49669"]]),me=N({__name:"MercadolibreCategoriesSelect",props:{modelValue:{type:Array},marketplace:{type:Object,required:!0},parent:{type:String},level:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,n=K(),o=V([]),g=V(!1),i=j(()=>o.value.length===0&&g.value===!1),v=j(()=>o.value.length?t.modelValue[t.level]:null),C=async()=>{if(g.value=!0,t.parent){const a=await q.listCategory(t.marketplace._id,t.parent);o.value=a.data.payload.children_categories}else{const a=await q.listCategories(t.marketplace._id);o.value=a.data.payload}g.value=!1};C(),Q(()=>t.parent,()=>{C();const a=t.modelValue.slice(0,t.level);l("update:modelValue",a)});const c=a=>{let y=[...t.modelValue];a?y[t.level]=a:y=y.slice(0,t.level),l("update:modelValue",y)},r=a=>{l("update:modelValue",a)};return(a,y)=>{const w=m("v-select"),U=m("MercadolibreCategoriesSelect",!0);return s(),f("div",{class:W({"mt-2":e.parent})},[_(i)?A("",!0):(s(),S(w,R({key:0,items:o.value,"item-title":"name","item-value":"id"},_(n),{loading:g.value,modelValue:_(v),"onUpdate:modelValue":c}),null,16,["items","loading","modelValue"])),_(v)?(s(),S(U,R({key:1,marketplace:e.marketplace,parent:_(v)},_(n),{level:e.level+1,modelValue:e.modelValue,"onUpdate:modelValue":r}),null,16,["marketplace","parent","level","modelValue"])):A("",!0)],2)}}}),pe=N({__name:"SellercenterCategoriesSelect",props:{modelValue:{type:Array},marketplace:{type:Object,required:!0},parent:{type:Object},level:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,n=K(),o=V([]),g=V(!1),i=j(()=>{if(t.parent){const a=t.parent.Children.Category;return Array.isArray(a)?a:[a]}return o.value}),v=j(()=>{if(!i.value.length)return null;const a=t.modelValue[t.level];return i.value.find(y=>y.CategoryId===a)}),C=async()=>{g.value=!0;const a=await q.listCategories(t.marketplace._id);o.value=a.data.payload,g.value=!1};t.parent||C(),Q(()=>t.parent,()=>{const a=t.modelValue.slice(0,t.level);l("update:modelValue",a)});const c=a=>{let y=[...t.modelValue];a?y[t.level]=a.CategoryId:y=y.slice(0,t.level),l("update:modelValue",y)},r=a=>{l("update:modelValue",a)};return(a,y)=>{const w=m("v-select"),U=m("SellercenterCategoriesSelect",!0);return s(),f("div",{class:W({"mt-2":e.parent})},[p(w,R({items:_(i),"item-title":"Name","item-value":"CategoryId","return-object":""},_(n),{loading:g.value,modelValue:_(v),"onUpdate:modelValue":c}),null,16,["items","loading","modelValue"]),_(v)&&_(v).Children?(s(),S(U,R({key:0,marketplace:e.marketplace,parent:_(v)},_(n),{level:e.level+1,modelValue:e.modelValue,"onUpdate:modelValue":r}),null,16,["marketplace","parent","level","modelValue"])):A("",!0)],2)}}}),ve=["onSubmit"],_e={class:"mb-4"},ge=N({__name:"MappingForm",props:{item:null},emits:["update:item"],setup(e,{emit:l}){const t=e,n=V([]),o=V({...t.item});q.list().then(i=>{n.value=i.data.payload});const g=()=>{l("update:item",o.value)};return(i,v)=>{const C=m("v-card-title"),c=m("v-text-field"),r=m("v-card-text"),a=m("v-spacer"),y=m("v-btn"),w=m("v-card-actions"),U=m("v-card");return s(),f("form",{onSubmit:Z(g,["prevent"])},[p(U,null,{default:k(()=>[p(C,null,{default:k(()=>[M(T(e.item.name),1)]),_:1}),p(r,null,{default:k(()=>[(s(!0),f(B,null,L(n.value,b=>(s(),f("div",_e,[M(T(b.name)+" ",1),b.type==="woocommerce"?(s(),S(c,{key:0,variant:"outlined",density:"compact","hide-details":""})):b.type==="mercadolibre"?(s(),S(me,{key:1,marketplace:b,density:"compact",variant:"outlined","hide-details":"",clearable:"",placeholder:"Seleccionar categoría",modelValue:o.value.mercadolibre,"onUpdate:modelValue":v[0]||(v[0]=d=>o.value.mercadolibre=d)},null,8,["marketplace","modelValue"])):A("",!0),b.type==="sellercenter"?(s(),S(pe,{key:2,marketplace:b,variant:"outlined",density:"compact","hide-details":"",clearable:"",placeholder:"Seleccionar categoría",modelValue:o.value.sellercenter,"onUpdate:modelValue":v[1]||(v[1]=d=>o.value.sellercenter=d)},null,8,["marketplace","modelValue"])):A("",!0)]))),256))]),_:1}),p(w,null,{default:k(()=>[p(a),p(y,{type:"submit"},{default:k(()=>[M("Guardar")]),_:1})]),_:1})]),_:1})],40,ve)}}});let O;const ye=new Uint8Array(16);function he(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(ye)}const h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function be(e,l=0){return(h[e[l+0]]+h[e[l+1]]+h[e[l+2]]+h[e[l+3]]+"-"+h[e[l+4]]+h[e[l+5]]+"-"+h[e[l+6]]+h[e[l+7]]+"-"+h[e[l+8]]+h[e[l+9]]+"-"+h[e[l+10]]+h[e[l+11]]+h[e[l+12]]+h[e[l+13]]+h[e[l+14]]+h[e[l+15]]).toLowerCase()}const fe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),P={randomUUID:fe};function Ce(e,l,t){if(P.randomUUID&&!l&&!e)return P.randomUUID();e=e||{};const n=e.random||(e.rng||he)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,l){t=t||0;for(let o=0;o<16;++o)l[t+o]=n[o];return l}return be(n)}const Ie=N({__name:"Categories",setup(e){const l=V([{label:"Departamento"},{label:"Categorias"},{label:"Categoria Hija"},{label:"Categoria Hija 2"},{label:"Categoria Hija 3"}]),t=V([]),n=V([]),o=V(!1),g=V(null),i=V(!1);F.list().then(d=>{n.value=d.data.payload});const v=j(()=>r(n.value)),C=d=>{g.value=d,i.value=!0},c=(d,u)=>{const I=[];for(const x of u)d._id===x.parent&&(Object.assign(x,{children:c(x,u)}),I.push(x));return I},r=d=>{const u=[];for(const I of d)I.parent===null&&(Object.assign(I,{children:c(I,d)}),u.push(I));return u},a=d=>{const u={_id:Ce(),name:"Categoria",parent:d,children:[],isNew:!0,mercadolibre:[],sellercenter:[]};n.value.push(u),t.value.push(u)},y=()=>{l.value.push({label:`Categoria Hija ${l.value.length-1}`})},w=d=>{let u=n.value.findIndex(x=>x._id===d._id);if(n.value.splice(u,1,d),u=t.value.findIndex(x=>x._id===d._id),u===-1)return t.value.push(d);t.value.splice(u,1,d)},U=async d=>{w(d),i.value=!1},b=async()=>{o.value=!0;const d=t.value.map(async u=>{const x=(u.isNew?await F.create(u):await F.update(u._id,u)).data.payload;Object.assign(u,x);const D=n.value.findIndex(z=>z._id===x._id);D!==-1&&n.value.splice(D,1,u)});await Promise.allSettled(d),t.value=[],o.value=!1};return(d,u)=>{const I=m("v-card-title"),x=m("v-btn"),D=m("v-card-text"),z=m("v-dialog"),X=m("v-card");return s(),S(X,{class:"overflow-x-auto"},{default:k(()=>[p(I,null,{default:k(()=>[M("Categorias")]),_:1}),p(D,{style:{display:"inline-block"}},{default:k(()=>[p(x,{class:"ml-3 mb-2",disabled:!t.value.length,loading:o.value,onClick:b},{default:k(()=>[M(" Guardar ")]),_:1},8,["disabled","loading"]),p(ue,{headers:l.value,items:_(v),onAddItem:a,onAddHeader:y,"onUpdate:item":w,onMappingClick:C},null,8,["headers","items"])]),_:1}),p(z,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=Y=>i.value=Y),"max-width":"600px"},{default:k(()=>[p(ge,{item:g.value,"onUpdate:item":U},null,8,["item"])]),_:1},8,["modelValue"])]),_:1})}}});export{Ie as default};
